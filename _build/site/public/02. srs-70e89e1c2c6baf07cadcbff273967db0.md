---
title: Software Requirements Specification
subtitle: Key Transfer System 
subject: DataMax Project
short_title: Software Requirements Specification
date: 2023-04-24
authors:
  - name: Tsvetelina Georgieva
    roles:
      - writing
      - review
      - visualisation
    email: cgeorgieva@datamax.bg
license: Apache-2.0
github: https://github.com/flower4e/key-transfer-myst.git
keywords: 3DS, security, acquiring
exports:
  - format: pdf
    template: plain_latex
    article_type: Report
---


## Използвани термини

| Термин                        | Описание                                                     |
| ----------------------------- | ------------------------------------------------------------ |
| **Криптографскa смарт картa** | Специализиран криптографски хардуер, който позволява да се използват  алгоритми като RSA и DSA; позволява да се генерира двойка секретни ключове на самата карта. |
| **Key Transfer Utility**      | Мобилно приложение, което има роля на криптографскa смарт картa. Разработено е с цел пренос на данни на криптографски ключове. |
| **Картов четец**              | Устройство, което предава данни на криптографскa смарт карта чрез безконтактна технология |
| **APDU**                      | Application Protocol Data Units - Команди, които четецът изпраща на смарт картата и съответно чете отговорите от нея |
| **BDK**                       | Base Derivation Key - Основен ключ за извличане. BDK случайно генериран и с негова помощ се  извеждат всички ключове на терминали |
| **HSM**                       | Hardware Security Module - Модул за хардуерна сигурност – физическо изчислително устройство, което защитава и управлява цифрови ключове, изпълнява функции за криптиране и декриптиране за цифрови  подписи, силно удостоверяване и други криптографски функции |

## Въведение

Целта на документа е да уточни общите системни изисквания, които управляват разработването и внедряването на системата. Документът също така установява първоначалните изисквания за функционалност, сигурност, обучение, капацитет и системна архитектура, както и критериите за приемане на системата.

### Обхват

Клиент и потребител на системата са служителите на Датамакс АД.

### Преглед

Продуктът е система за пренос на данни на криптографски ключове. Обменът се извършва между картов четец и криптографска смарт карта чрез Application Protocol Data Unit (APDU), както и между криптографска смарт карта и терминал.

## Общо описание

### Функции на продукта

Продуктът има за цел да направи преноса на данни и целия процес по-лесен и рационализиран за потребителите, в рамките на ефективно време.

### Подробна системна информация

Продуктът се разработва с картов четец и APDU, така че има голям брой подобни системи и те се използват за широк спектър от различни цели. Възможната сила на настоящата система над мнозинството е функцията за удостоверяване в моментите на трансфер на ключовете, което осигурява високо ниво на сигурност в процеса на пренос на данните – задължително условие за работа с криптографски ключове в съответствие с PCI Security Standards.

## Участници

Участниците и компонентите в системата са следните:

- Hardware
  - [Terminal Key Distribution Station](tkd-s)
  - [HSM](hsm)
  - [Картов четец](reader)
  - [Терминал](terminal)
  - [Мобилно устройство_1](device)
  - [Мобилно устройство_2](device)
  
- Software
  - [Linux](linux)
  - Android OS
  - [Key Transfer Utility](utility)
  - [Terminal-kdc](terminal-kdc)
  - [BDK](bdk)
  - [APDU](apdu)

## Изисквания

Изискванията, изброени в следващите подточки са съобразени в съответствие с PCI Security Standards и останалите водещи стандарти за осигуряване сигурност на данни и достъпа до тях.

(tkd-s)=
### Terminal Key Distribution Station

- Станцията е разположена в помещение с ограничен достъп и постоянно видео наблюдение
- До станцията имат достъп единствено служители със съответни права и роли
- Terminal Key Distribution Station e физическа станция, на която са свързани следните външни устройства:
  - HSM
  - Картов четец

- На станцията е инсталиран следния софтуер:  
  - OS Linux
  - terminal-kdc - софтуер за зареждане на криптографски ключове, които предстои да бъдат трансферирани на смарт карта

(hsm)=
### HSM

- HSM отговаря на всички изисквания за сигурност, изведени в PCI Security Standards
- HSM е в списък с лицензирани устройства
- HSM генерира BDK на случаен принцип

(reader)=
### Картов четец

- Свързан с Terminal Key Distribution Station 
- Съвместим с OS Linux
- Работи с terminal-kdc
- Предава данни от terminal-kdc на крипто смарт карта (Key Transfer Utility) чрез APDU

(terminal)=
### Терминал

- NFC
- Приема данни на крипто ключове от смарт карта
- Изисква въвеждане на парола за обмяна на ключове

(device)=
### Мобилно устройство - 2бр.

- OS Android
- Инсталирано приложение Key Transfer Utility
- NFC
- Biometrics

(linux)=
### OS Linux

- Инсталирана на Terminal Key Distribution Station

- За вход в системата, OS Linux изисква оторизиране на потребителя с потребителско име и парола

(api)=
### Потребителски интерфейс

- След осъществяване на вход от потребителя, системата извежда директно интерфейса на terminal-kdc, където следва потребителя да въведе данни на ключ и терминал за трансфер

(utility)=
### Key Transfer Utility

- Съвместим с OS Android
- Ползва NFC на устройството
- Ползва опцията за биометрия на устройството
- Получава данни от картов четец чрез APDU
- Предава данни на терминал чрез NFC

(terminal-kdc)=
### Terminal-kdc

- Съвместим с OS Linux
- Съвместим с HSM
- Ползва BDK от HSM
- Свързан с картов четец
- Предава данни на ключове към крипто смарт карта чрез картов четец

(bdk)=
### BDK

- BDK са генерирани на случаен принцип от HSM 
- Чрез BDK се извеждат всички ключове на терминали 

(apdu)=
### APDU

Application Protocol Data Unit
- Съдържа задължителен 4-byte header (CLA, INS, P1, P2)
- Съдържа от 0 до 65 535 байта данни
- Когато данните са повече от 256 байта, се прилага допълнително разделяне на фрагменти

## Оперативни сценарии

### Качване на BDK на Key Distribution Station

- Администратор въвежда ръчно на terminal-kdc етикет на ключ и компоненет 1 и 2 на ключа 
- Key Distribution Station ги изпраща на HSM заедно с importSecretKey 
- HSM изпраща BDK на key-distribution-station

*[Диаграма](loadbdk)*

### Export РРК / ТМК

- Оператор 1 и Оператор 2 се идентифицират при вход в защитеното помещение
- Оператор 1 се оторизира в Terminal Key Distribution Station чрез потребителско име и парола
- Стартира се програма Terminal-kdc
- Terminal-kdc изисква поставянето на мобилно устройство с инсталирано приложение Key Transfer Utility върху картовия четец
- Оператор 1 зарежда на terminal-kdc (зареждането се осъществява чрез BDK, генериран на случаен принцип в HSM):
  - идентификационен номер на терминал, за който е предназначен трансфера
  - вида на криптографски ключ (TMK, PPK, etc.)
  - Export РРК / ТМК: трансферът се извършва чрез 2 компонента на ключа

- Оператор 1 заявява трансфер на ключа чрез мобилно приложение Key Transfer Utility, което само по себе си е криптографска смарт карта.
- Приложението изисква удостоверяване на оператора
- Оператор 1 се идентифицира чрез биометрия
- Картовият четец предава Компонент 1 от ключа на Key Transfer Utility чрез APDU.  
- Key Transfer Utility извежда на екрана съобщение, съдържащо данни за успешен трансфер на Компонент 1 на ключа, дата, име и роля на оператор, идентификационен номер на терминала, верификационен код на ключа. Извежда се съобщение за необходимостта устройството да бъде премахнато от четеца, за да се постави второто мобилно устройство за трансфер на Компонент 2 на ключа.
- Оператор 1 премахва устройството от четеца
- Оператор 2 поставя втрото мобилно устройство с инсталирано приложение Key Transfer Utility на картовия четец
- Оператор 2 оторизира трансфера чрез своите биометрични данни
- На екрана на устройството се извежда съобщение за вече успешно трансфериран Компонент 1 на ключа и готовност за трансфер на Компонент 2
- Оператор 2 потвърждава трансфера
- Картовият четец предава Компонент 2 от ключа на Key Transfer Utility чрез APDU.  
- На екрана на устройството се извежда съобщение за успешен трансфер на Компонент 2 на ключа, дата, име и роля на оператор, идентификационен номер на терминала, верификационен код на ключа.
- В случай, че някои от етапите не бъде преминат успешно, процедурата се започва от начало
- Зареждане ключ на терминал: Оператор 1 и Оператор 2, идентично на трансфера, последователно зареждат на терминала двата компонента на ключа. За извършване на зареждането, операторите се идентифицират чрез биометрия. Ключът може да бъде зареден единствено на терминала, чийто идентификационен номер е свързан с ключа.

*[Диаграма](exp)*

### Wrap PPK

- Оператор 1 се идентифицира при вход в защитеното помещение
- Оператор 1 се оторизира в Terminal Key Distribution Station чрез потребителско име и парола
- Стартира се програма Terminal-kdc
- Terminal-kdc изисква поставянето на мобилно устройство с инсталирано приложение Key Transfer Utility върху картовия четец
- Оператор 1 зарежда на terminal-kdc (зареждането се осъществява чрез BDK, генериран на случаен принцип в HSM):
  - идентификационен номер на терминал, за който е предназначен трансфера
  - вида на криптографски ключ (TMK, PPK, etc.)
  - Wrap PPK 

- Оператор 1 заявява трансфер на ключа чрез мобилно приложение Key Transfer Utility, което само по себе си е криптографска смарт карта.
- Приложението изисква удостоверяване на оператора
- Оператор 1 се идентифицира чрез биометрия
- Картовият четец предава PPK данните на Key Transfer Utility чрез APDU.  
- Key Transfer Utility извежда на екрана съобщение, съдържащо данни за успешен трансфер на ключа, дата, име и роля на оператор, идентификационен номер на терминала, верификационен код на ключа.
- В случай, че някои от етапите не бъде преминат успешно, процедурата се започва от начало
- Зареждане ключ на терминал: Оператор 1 зарежда ключа от Key Transfer Utility на терминал, за който предварително е предназначен ключа. За извършване на зареждането, операторът се идентифицира чрез биометрия. 

*[Диаграма](wrapppk)*

### [Зареждане на ключ на ПОС терминал](plain_load_terminal)

- Оператор заявява зареждане на ключове на терминала чрез команда SELECT FILE
- Терминалът изпълнява команда EXTERNAL AUTHENTICATE
- Операторът въвежда парола за обмяна на ключове. Паролата е статична или динамично се извежда на екрана на терминала.
- Терминалът изпълнява команда GET DATA, с която взима данните от мобилното устройство за зареждане 
- Терминалът зарежда ключа 

## Сигурност

Всички изисквания на PCI DSS се спазват.

Нивото на сигурност е високо, в съответствие с изискванията за работа с криптографски ключове. Трансферът се извършва в защитена среда. Изисква се идентифициране на потребителя за вход в помещението, както и за вход в Terminal Key Distribution Station. Операторът на мобилното приложение се оторизира в момента на трансфер на ключа, също и в момента на зареждане на ключа в терминала. 

## Надеждност

Надеждността е едно от основните качества на системата. Съхраняват се журнали на извършените действия от съответните оператори и резервни копия, за да е възможно възстановяване с минимална загуба на данни в случай на непредвидени събития. Системата се тества от всички членове на екипа, за да се гарантира надеждността.

## Тест на системата

Тест на работата на системата се извършва веднъж на 3 (три) месеца от служителите, определени в т. Роли, права и отговорности в настоящия документ.

## Документация

Преглед актуалността на документацията и редакция в случай на необходимост се извършва веднъж на 3 (три) месеца от служителите, определени в т. Роли, права и отговорности в настоящия документ.

## Роли, права и отговорности

### Администратор

Отговорности по управлението сигурността на системата.

| Име  | Права                                                        |
| ---- | ------------------------------------------------------------ |
|      | Достъп до системните настройки на Terminal Key Distribution Station |
|      | Тест на системата веднъж на 3 (три) месеца                   |
|      | Достъп и преглед на журналите                                |
|      | Достъп и възстановяване на резервни копия в случай на инциденти |
|      | Достъп до системните настройки на Key Transfer Utility. Управление данните на операторите, които извършват трансфер чрез приложението. |
|      | Преглед актуалността на документацията веднъж на 3 (три) месеца |

### Оператор Terminal Key Distribution Station

| Име  | Права                                                        | Отговорности                                                 |
| ---- | ------------------------------------------------------------ | ------------------------------------------------------------ |
|      | Достъп до помещението, където се намира Terminal Key Distribution Station | Идентифицира се при всяко влизане в помещението              |
|      | Разполага с потребителско име и парола за достъп до Terminal Key Distribution Station | Идентифицира се с потребителско име и парола за вход в станцията |
|      | Генериране на ключ за терминал                               | Въвеждане тип на ключ и терминал, за който е предназначен    |

### Оператор Оператор Key Transfer Utility

| Име  | Права                            | Отговорности                               |
| ---- | -------------------------------- | ------------------------------------------ |
|      | Трансфер на ключ от картов четец | Заявява трансфер                           |
|      | Зареждане на ключ на терминал    | Потвърждава трансфер с биометрия           |
|      |                                  | Заявява зареждане                          |
|      |                                  | Избира ключ от списък в приложението       |
|      |                                  | Потвърждава зареждане с биометрия          |
|      |                                  | Въвежда парола за обмен на ключ в терминал |
|      |                                  | Изтрива ключ от приложението (по избор)    |

### Technical writer

| Име          | Права                                | Отговорности                                                 |
| ------------ | ------------------------------------ | ------------------------------------------------------------ |
| Ц. Георгиева | Съставяне и редакция на документация | Съставяне и редакция на документацията |

## История на промените

| Версия | Дата       | Описание                                                     | Извършил промяната |
| ------ | ---------- | ------------------------------------------------------------ | ------------------ |
| 1.0    | 13.01.2023 | Начална версия                                               | Ц. Георгиева       |
| 1.1    | 24.03.2023 | Добавено второ мобилно устройство за разделяне двата компонента на крипт. ключ при трансфер | Ц. Георгиева       |
| 1.2    | 24.04.2023 | Добавено зареждане на ключ на ПОС терминал                   | Ц. Георгиева       |
